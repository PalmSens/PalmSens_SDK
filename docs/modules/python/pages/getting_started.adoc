= Working with files

As of version 5 of the PalmSens SDK and PSTrace measurements, and their corresponding methods are stored in `.pssession` files.
Methods can be stored separately in `.psmethod` files.

The PalmSens SDK is backward compatible with following filetypes:

|===
| File | vs potential (scan method) | Measurement vs time

|Method
|`.psmethod`
|`.psmethod`

|Method (before 2012)
|`.pms`
|`.pmt`

|Data (single curve)
|`.pss`
|`.pst`

|Analysis curves
|`.psd`
|

|Multiplexer curves
|
|`.mux`
|===

`pypalmsens` contains the functions needed to load and save methods and session files.
The session file contains the measurement data, whereas the method file contains method information.

== Loading and saving a method file (`.psmethod`)

The `pypalmsens.load_method_file()` can be used to load method files.
This returns a 'Method' dataclass with all the method parameters.

[source,python]
----
>>> method = pypalmsens.load_method_file('PSDummyCell_LSV.psmethod')
>>> method
LinearSweepParameters(
    'conditioning_time': 0.0,
    'begin_potential': -5.0,
    'end_potential': 5.0,
    'step_potential': 0.01,
    'scanrate': 1.0,
    ...
)
----

Save the method using `pypalmsens.save_method_file()`.

[source,python]
----
>>> pypalmsens.save_method_file(method, 'PSDummyCell_LSV.psmethod')
----


== Setting up a method

The following methods are supported:

Voltammetric Techniques::

- Linear Sweep Voltammetry
- Cyclic Voltammetry
// - Fast Cyclic Voltammetry
// - AC Voltammetry

Pulsed Techniques::

- Differential Pulse Voltammetry
- Square Wave Voltammetry
// - Normal Pulse Voltammetry

Amperometric Techniques::

- Chronoamperometry
- Multistep Amperometry
// - Fast Amperometry
// - Pulsed Amperometric Detection
// - Multiple Pulse Amperometry

Potentiometric Techniques::

- Open Circuit Potentiometry
- Chronopotentiometry
// - Linear Sweep Potentiometry
// - Multistep Potentiometry
// - Stripping Chronopotentiometry

// Coulometric techniques::

// - Chronocoulometry

Other::

- Impedance Spectroscopy
// - Fast Impedance Spectroscopy
- Galvanostatic Impedance Spectroscopy
// - Fast Galvanostatic Impedance Spectroscopy
// - Mixed Mode
- Method Script

This example creates a method for a square-wave voltammetry measurement versus the open circuit potential:

[source,python]
----
>>> import pypalmsens
>>> method = pypalmsens.methods.SquareWaveParameters(
...    conditioning_potential = 2.0,  # V
...    conditioning_time = 2,  # seconds
...    versus_ocp_mode = 3,  # versus begin and end potential
...    versus_ocp_max_ocp_time = 1,  # seconds
...    begin_potential = -0.5,  # V
...    end_potential = 0.5,  # V
...    step_potential = 0.01,  # V
...    amplitude = 0.08,  # V
...    frequency = 10,  # Hz
...)
----

Because methods are https://www.attrs.org/[attrs dataclasses], all attributes can be modified:

[source,python]
----
>>> method.begin_potential = -1.0
>>> method.end_potential = 1.0
>>> method.step_potential = 0.02
----

It can be serialized to and from a dictionary:

[source,python]
----
>>> from attrs import asdict
>>> d = asdict(method)
>>> d
{'equilibration_time': 0.0,
 'begin_potential': -1.0,
 'end_potential': 1.0,
 'step_potential': 0.02,
 'frequency': 10,
 'amplitude': 0.08,
 ...}
>>> method2 == pypalmsens.methods.SquareWaveParameters(**d)
>>> method == method2
True
----

It can be updated like a dataclass:

[source,python]
----
>>> from attrs import evolve
>>> method2 = evolve(method, equilibration_time=10.0)
>>> method == method2
False
----

[TIP]
====
The VSCode Debug Console or another Python REPL environment like https://ipython.readthedocs.io[IPython] will auto complete on the properties and functions.

image:vscode_autocomplete.png[Debug console in VSCode]
====

== Loading and saving data

image:pssession.png[Data in pssession files]

Data from measurements can be loaded from and stored to `.pssession` files.
This contains a session with one or more measurements containing its respective method and curves.

The `pypalmsens.load_session_file()` can be used to load session files.
It returns a list of measurements, which contains the dataset and curves.
The dataset is a list of raw data in array form, whereas the curves resemble the plots.
In PSTrace or PSTrace Express these would be the 'Data' and the 'Plot' tab, respectively.

The exceptions are (galvanostatic) electrochemical impedance spectroscopy measurements, which contain additional plots.

The measurement and curve classes are defined in the `.curves` attribute, the ral data by the `.dataset` attribute, and the EIS data by the `.eis_data` attribute.

The following example loads a collection of measurements from a session file and saves the first measurement to a different file.

[source,python]
----
>>> from pypalmsens import load_session_file

>>> measurements = load_session_file('my_measurement.pssession')
>>>
>>> pypalmsens.save_session_file(
...     'my_measurement_copy.pssession',
...     [measurements[0]]
... )
----
